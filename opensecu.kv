
#:import math math

[GaugeNumber@Label]:
    text: str(ctx.i)
    pos_hint: {"center_x": 0.5+0.42*math.sin(math.pi/8*(ctx.i-6)), "center_y": 0.5+0.42*math.cos(math.pi/8*(ctx.i-6))}
    font_size: self.height/24

<OpensecuGauge>:
    anchor_x: 'center'
    anchor_y: 'center'
    size_hint:None,None


<OpensecuReadings>:
    # pos_hint: {'center_x': 0.2, 'center_y': 1}
    size_hint:(0.5,0.1)
    text_size: root.width, root.height
    font_size: self.height/2
    halign: 'left'
    valign: 'middle'
    markup: True
    # canvas.before:
    #     Color:
    #         rgba: 0.12,0,0.122,0.5
    #     Rectangle:
    #         pos: self.pos
    #         size: self.size


<OpensecuNeedle>:
    source: "resources/needle.png"
    size: self.texture_size
    pos_hint: {'center_x': .5, 'center_y': .5}
    canvas.after:
        PopMatrix


<OpensecuWindow>:
    id: opensecu
    display: cmd
    needle: needle
    gauge: gauge


    gauge_level: -135
    needle_level: -135
    rpm: 0

    # Main windows
    rows:2
    spacing: 10
    padding: 10

    canvas:
        Color:
            rgba: 0.1,0.1,0.1,1
        Rectangle:
            pos: self.pos
            size: self.size


##########################################################

    GridLayout:
        size_hint: 1,1
        cols: 3

#-------------------------- Data -----------------------------#
        #Data
        BoxLayout:
            canvas.before:
                Color:
                    rgba: 0.12,0.1195,0.122,1
                Rectangle:
                    pos: self.pos
                    size: self.size

            BoxLayout:
                orientation: 'vertical'
                padding: self.width* 0.1, self.height* 0.15
                size_hint: 1,0.6
                pos_hint:{'center_x': 0, 'center_y': 0.5}
                OpensecuReadings:
                    text: "Readigns"
                    font_size: self.height/1.5
                OpensecuReadings:
                    text: "IMP: " + root.imp
                OpensecuReadings:
                    text: "Air mass: " + root.amass
                OpensecuReadings:
                    text: "fuel mass: " + root.fmass
                OpensecuReadings:
                    text: "Frequency " + root.freq





#---------------------- Tachometer RPM ------------------------#
        BoxLayout:
            size_hint: 1.5,1

            canvas.before:
                Color:
                    rgba: 0.12,0.1195,0.122,1
                Rectangle:
                    pos: self.pos
                    size: self.size

            AnchorLayout:
                anchor_x: 'center'
                anchor_y: 'center'

                FloatLayout: #gauges numers
                    size_hint:None,None
                    size: (min(self.parent.size) * 0.95 ) , (min(self.parent.size) * 0.95 )
                    GaugeNumber:
                        i: 0
                    GaugeNumber:
                        i: 1
                    GaugeNumber:
                        i: 2
                    GaugeNumber:
                        i: 3
                    GaugeNumber:
                        i: 4
                    GaugeNumber:
                        i: 5
                    GaugeNumber:
                        i: 6
                    GaugeNumber:
                        i: 7
                    GaugeNumber:
                        i: 8

                AnchorLayout: #gauges dots
                    anchor_x: 'center'
                    anchor_y: 'center'
                    size_hint:None,None
                    size: (min(self.parent.size) * 0.68 ) , (min(self.parent.size) * 0.68 )
                    Image:
                        source: "resources/gauge.png"
                        size: self.texture_size


                OpensecuGauge: #gauges level rail

                    canvas.before:
                        Color:
                            rgba: 0.1,0.1,0.1,1
                        Line:
                            width: min(self.size)/15
                            circle:
                                (self.center_x, self.center_y, min(self.width, self.height)
                                / 2, -135.5, 45, 500)
                            cap: 'none'

                    size: (min(self.parent.size) * 0.5 ) , (min(self.parent.size) * 0.5 )


                OpensecuGauge: #gauges levels
                    id: gauge
                    canvas.before:
                        Color:
                            rgba: 0,0.93,1,0.5
                        Line:
                            width: min(self.size)/15
                            circle:
                                (self.center_x, self.center_y, min(self.width, self.height)
                                / 2, -135, self.gauge_level , 50)
                            cap: 'none'

                    size: (min(self.parent.size) * 0.5 ) , (min(self.parent.size) * 0.5 )


                AnchorLayout: #blue line in gauge
                    anchor_x: 'center'
                    anchor_y: 'center'
                    canvas.before:
                        Color:
                            rgba: 0,0.93,1,0.5
                        Line:
                            width: min(self.width, self.height) / 100
                            circle:
                                (self.center_x, self.center_y, min(self.width, self.height)
                                / 2, 0, 360 , 50)
                            cap: 'none'

                    size_hint:None,None
                    size: (min(self.parent.size) * 0.38 ) , (min(self.parent.size) * 0.38 )



                BoxLayout: #gauge real time RPMS
                    size_hint:None,None
                    size: (min(self.parent.size) * 0.38 ) , ((min(self.parent.size) * 0.38) )
                    Label:
                        text: str(int(root.rpm))
                        pos_hint: {"center_x": 0.5, "center_y": 0.65}
                        font_size: self.height / 6


                BoxLayout:#gauges RPM note
                    size_hint:None,None
                    size: (min(self.parent.size) * 0.38 ) , ((min(self.parent.size) * 0.38) )
                    Label:
                        text: "RMP"
                        pos_hint: {"center_x": 0.5, "center_y": 0.35}
                        font_size: self.height / 12


                BoxLayout:#gauges x1000
                    size_hint:None,None
                    size: (min(self.parent.size) * 0.38 ) , ((min(self.parent.size) * 0.38) )
                    Label:
                        text: "x1000"
                        pos_hint: {"center_x": 0.5, "center_y": 0.25}
                        font_size: self.height / 10



                FloatLayout: #gauges needle
                    anchor_x: 'center'
                    anchor_y: 'center'
                    size_hint:None,None
                    size: (min(self.parent.size) * 0.60 ) , (min(self.parent.size) * 0.60 )
                    OpensecuNeedle:
                        id: needle
                        canvas.before:
                            PushMatrix
                            Rotate:
                                angle: (self.needle_level)* (-1)
                                origin: self.center



#------------------------ Volumetric Efficiency Table -------------------------#

        BoxLayout:
            canvas:
                Color:
                    rgba: 0.12,0.1195,0.122,1
                Rectangle:
                    pos: self.pos
                    size: self.size
            Label:
                text: "I'm label 3"



###################################################################


#------------------------ Console -------------------------#
    BoxLayout:
        size_hint: 1,0.3
        canvas:
            Color:
                rgba: 0.12,0.1195,0.122,1
            Rectangle:
                pos: self.pos
                size: self.size

        TextInput:
            id: cmd
            text: "ecu> "
            background_color: 0.12,0.1195,0.122,1
            foreground_color: 1,1,1,1
            boold: 1
            padding: 15
            multiline: False
            on_text: opensecu.bashlook(self.text, self.cursor)
            on_text_validate: opensecu.on_enter(self.text)
            # on_key_down:opensecu.on_enter(self.text)